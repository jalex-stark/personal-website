jQuery(document).ready(function(e){function t(){var t=e("#wsko_reporting_objects_list"),i=t.data("update-timeout");i&&clearTimeout(i)}function i(){t();var i=e("#wsko_reporting_objects_list");i.data("update-timeout",setTimeout(function(){var t={};e("#wsko_reporting_objects_list .wsko-reporting-view.wsko-reporting-view-enabled").each(function(i){var o=e(this),n={};o.find(".wsko-reporting-view-item.wsko-reporting-view-enabled").each(function(t){var i=e(this),o={f:!0};i.find(".wsko-reporting-item-setting").each(function(t){var i=e(this);o[i.attr("name")]=i.val()}),n[i.data("item")]={settings:o}}),t[o.data("view")]=n}),window.wsko_post_element({action:"wsko_reporting_update_data",data:t,nonce:e("#wsko_reporting_objects_list").data("update-nonce")},function(e){e.success},function(){},e("#wsko_reporting_objects_list"),!1)},2e3))}function o(){e(".wsko-reporting-mail-item:not(#wsko_reporting_mail_item_template) .wsko-change-reporting-mail:not(.wsko-rp-init)").addClass("wsko-rp-init").click(function(t){t.preventDefault();var i=e(this),o=i.closest(".wsko-reporting-mail-item").data("mail");window.wsko_post_element({action:"wsko_reporting_change_mail",mail:o,set:i.is(":checked"),nonce:e("#wsko_reporting_mail_wrapper").data("change-nonce")},function(e){e.success},function(){},i,!1)}),e(".wsko-reporting-mail-item:not(#wsko_reporting_mail_item_template) .wsko-remove-reporting-mail:not(.wsko-rp-init)").addClass("wsko-rp-init").click(function(t){t.preventDefault();var i=e(this),o=i.closest(".wsko-reporting-mail-item").data("mail");window.wsko_post_element({action:"wsko_reporting_remove_mail",mail:o,nonce:e("#wsko_reporting_mail_wrapper").data("remove-nonce")},function(e){e.success&&i.closest(".wsko-reporting-mail-item").remove()},function(){},i,!1)})}e(".wsko-import-backup:not(.wsko-init)").addClass("wsko-init").click(function(t){t.preventDefault();var i=e(this);window.wsko_post_file(i.closest(".wsko-import-backup-wrapper").find(".wsko-import-backup-file")[0].files[0],{action:"wsko_import_configuration_backup",nonce:i.data("nonce")},!1,function(e){e.success&&location.reload()},function(){},i,!0)}),e(".wsko-reporting-white-label-image-button:not(.wsko-init)").addClass("wsko-init").click(function(t){t.preventDefault();var i=e(this),o=i.closest(".wsko-reporting-white-label-image-wrapper");if(void 0===this.window){this.window=wp.media({title:"Insert a media",library:{type:"image"},multiple:!1,button:{text:"Insert"}});var n=this;this.window.on("select",function(){var e=n.window.state().get("selection").first().toJSON();window.wsko_post_element({action:"wsko_import_white_label",url:e.url,nonce:o.data("nonce")},function(t){return t.success&&(o.find(".wsko-reporting-white-label-image").attr("src",e.url),o.find(".wsko-reporting-white-label-image-button-remove").show()),!1},function(){},i,!1)})}this.window.open()}),e(".wsko-reporting-white-label-image-button-remove:not(.wsko-init)").addClass("wsko-init").click(function(t){t.preventDefault();var i=e(this),o=i.closest(".wsko-reporting-white-label-image-wrapper");window.wsko_post_element({action:"wsko_import_white_label",url:"",nonce:o.data("nonce")},function(e){return e.success&&(o.find(".wsko-reporting-white-label-image").attr("src",""),o.find(".wsko-reporting-white-label-image-button-remove").hide()),!1},function(){},i,!1)}),e("#wsko_reporting_add_mail:not(.wsko-init)").addClass("wsko-init").click(function(t){t.preventDefault();e(this);e("#wsko_reporting_mail_wrapper .wsko-reporting-mail-input").show().focus()}),e("#wsko_reporting_mail_wrapper .wsko-reporting-mail-input:not(.wsko-init)").addClass("wsko-init").blur(function(t){t.preventDefault();var i=e(this);i.hide()}).keyup(function(t){if(13==t.which){var i=e(this),n=i.val();window.wsko_post_element({action:"wsko_reporting_add_mail",mail:n,nonce:i.data("nonce")},function(t){if(t.success){var s=e("#wsko_reporting_mail_item_template").clone().attr("id","").show().appendTo("#wsko_reporting_mail_wrapper .wsko-reporting-mail-list");s.find(".wsko-reporting-mail-text").html(n),s.data("mail",n),i.blur(),i.val(""),o()}},function(){},i,!1)}}),e(".wsko-reporting-select-add-view:not(.wsko-init)").addClass("wsko-init").change(function(t){t.preventDefault();var o=e(this),n=o.val();if(Array.isArray(n)){for(var s=n.length,r=!1,a=0;a<s;a++)if("-1"!=n[a]){n=n[a],r=!0;break}r||(n="-1")}if("-1"!=n){var w=e(".wsko-reporting-view.wsko-reporting-view-enabled").last(),l=e(".wsko-reporting-view-item-"+n).closest(".wsko-reporting-view").find(".wsko-reporting-view-item.wsko-reporting-view-enabled").last(),p=e(".wsko-reporting-view-item-"+n).addClass("wsko-reporting-view-enabled"),c=p.closest(".wsko-reporting-view");l&&l.length&&p.insertAfter(l),!c.hasClass("wsko-reporting-view-enabled")&&w&&w.length&&c.insertAfter(w),c.addClass("wsko-reporting-view-enabled"),o.find("option.wsko-reporting-select-view-item-"+n).attr("disabled",!0),o.val("-1").change(),o.selectpicker("refresh"),i()}}),"undefined"!=typeof jQuery.ui&&"undefined"!=typeof jQuery.ui.draggable&&"undefined"!=typeof jQuery.ui.droppable&&(e(".wsko-reporting-views-list").sortable({start:function(e,i){t()},stop:function(e,t){i()}}),e(".wsko-reporting-view-items-list").sortable({start:function(e,i){t()},stop:function(e,t){i()}}),e(".wsko-reporting-views-list").disableSelection(),e(".wsko-reporting-view-items-list").disableSelection()),e(".wsko-reporting-view-delete:not(.wsko-init)").addClass("wsko-init").click(function(t){t.preventDefault();var o=e(this);e(".wsko-reporting-view-"+o.data("view")).removeClass("wsko-reporting-view-enabled").find(".wsko-reporting-view-item-delete").click(),e("select.wsko-reporting-select-add-view").find("optgroup.wsko-reporting-select-view-"+o.data("view")+" option").attr("disabled",!1),e("select.wsko-reporting-select-add-view").selectpicker("refresh"),i()}),e(".wsko-reporting-view-item-delete:not(.wsko-init)").addClass("wsko-init").click(function(t){t.preventDefault();var o=e(this);e(".wsko-reporting-view-item-"+o.data("view")+"-"+o.data("item")).removeClass("wsko-reporting-view-enabled"),e(".wsko-reporting-view-"+o.data("view")+" .wsko-reporting-view-item.wsko-reporting-view-enabled").length?e("select.wsko-reporting-select-add-view").find("option.wsko-reporting-select-view-item-"+o.data("view")+"-"+o.data("item")).attr("disabled",!1):(e(".wsko-reporting-view-"+o.data("view")).removeClass("wsko-reporting-view-enabled"),e("select.wsko-reporting-select-add-view").find("optgroup.wsko-reporting-select-view-"+o.data("view")+" option").attr("disabled",!1)),e("select.wsko-reporting-select-add-view").selectpicker("refresh"),i()}),e(".wsko-reporting-item-setting:not(.wsko-init)").addClass("wsko-init").change(function(e){i()}),e(".wsko-toggle-reporting-switch").on("wsko_ajax_input_save_success wsko_ajax_input_save_fail",function(t){e(this).is(":checked")?(e(".wsko-reporting-toggle-visible").show(),e(".wsko-reporting-toggle-hidden").hide()):(e(".wsko-reporting-toggle-visible").hide(),e(".wsko-reporting-toggle-hidden").show())}),o()});